<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--doc-version-default-links-begin-->
<!-- Please do not edit the below line(s) manually, see DocumentVersioning.qs (151018182358), version 1.0.0.1-->
<!-- Bootstrap core CSS -->
<link href="../../bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet"/>
<!-- Bootstrap theme -->
<link href="../../bootstrap/css/bootstrap-theme.min.css" type="text/css" rel="stylesheet"/>
<!-- Code-Prettify -->
<link href="../../google-code-prettify/prettify.css" type="text/css" rel="stylesheet"/>
<script src="../../google-code-prettify/prettify.js" type="text/javascript"></script>
<!-- Custom styles for this template -->
<link href="../../css/custom_theme.css" type="text/css" rel="stylesheet"/>
<!--doc-version-default-links-end-->
<!--doc-version-title-begin-->
<!-- Please do not edit the below line(s) manually, see DocumentVersioning.qs (151018182358), version 1.0.0.1-->
<title>Garbage Collection v1.0</title>
<!--doc-version-title-end-->
<style type="text/css">
.auto-style1 {
	text-decoration: underline;
}
</style>
</head>
<body>
    <div class="container">

<!--doc-version-default-header-begin-->
<!-- Please do not edit the below line(s) manually, see DocumentVersioning.qs (151018182358), version 1.0.0.1-->
	<div class="doc-header">
		<div class="alert alert-info" role="alert">
			<h1>Garbage Collection</h1>
			<div class="row">
				<div class="col-md-4"><p><strong>Document version:</strong>1.0</p></div>
				<div class="col-md-4"><p><strong>Author(s):</strong>Sven Gijsen</p></div>
				<div class="col-md-4"><p><strong>Date:</strong>July 2015</p></div>
			</div>
		</div>
	</div>
<!--doc-version-default-header-end-->
    <h2>
        Introduction</h2>
		<p>
The internal BrainStim script engine uses a garbage collection method to r<span class="auto-style1">eclaim memory used by the script objects when they are no longer needed</span>. An object's memory can be automatically reclaimed when it is no longer referenced anywhere in the scripting environment context by the script engine garbage collector. If all referenced (allocated) memory is successfully reclaimed and the script context ends then the internal BrainStim script engine automatically exits. If this is not the case then the script remains in a running state and thus does not end 
		and the script 'hangs' (waits...) and to proceed we'll need to manually 
		restart it. </p>
		<h2>
		Guidelines</h2>
		<p>
		For the garbage collection to work properly you need to make sure that you follow the following guidelines before ending the script context:

</p>
		<ol>
			<li>Disconnect all previous made signal/slot connections (signal slot connections are 
			described in this document) using the <em><strong>disconnect</strong></em> 
			statement.
</li>
			<li>Set all previously dynamic constructed object (where you used the
			<strong>new</strong> 
			keyword) to 
			<em>null</em>.</li>
			<li>Set all previously defined script functions to <em>null</em>.</li>
			<li>At last call the <strong><em>BrainStim.cleanupScript()</em></strong> function to force a remaining automatic garbage collection to make sure that all the claimed script memory is released.
			</li>
		</ol>
		<h2>Example</h2>
		<p>Let's use an example to examine the above in more detail.</p>
		<ol>
			<li>Start BrainStim.
</li>
			<li style="box-sizing: border-box;">Open the<span class="Apple-converted-space">&nbsp;<em>GarbageCollection.qs 
			</em></span>file 
			located in the  
			<a href="../GettingStartedGuide/GettingStartedGuide.html#MainProgramdirectory">Main Program Directory</a> directory under the subfolder 
			<em>\Examples\BrainStim\QtScript GarbageCollection\</em>.</li>
			<li style="box-sizing: border-box;">Examine the QtScript code and 
			notice that:<ul>
				<li style="box-sizing: border-box;">a <em>QTimer</em> object is 
				created using the <strong>new</strong> keyword</li>
				<li style="box-sizing: border-box;">this newly created <em>
				QTimer</em> object is then connected trough a signal/slot 
				connection to a local script function</li>
				<li style="box-sizing: border-box;">Every time this function is 
				then automatically called by the <em>QTimer</em> object a 
				variabele is decremented and checked if it's lower than 0, if so 
				then a <em>ScriptCleanupFunction</em> function is called to 
				perform a script garbage collection using the above guidelines.</li>
			</ul>
			</li>
			<li style="box-sizing: border-box;">Execute (press the <kbd>F5</kbd> key) the QtScript code 
			see what happens and wait till the script automatically ends.</li>
			<li style="box-sizing: border-box;">Let's see what happens if we 
			don't follow the above guidelines. Comment (by writing "//"&nbsp; 
			before the codeline) the line where the <em>QTimer</em> object is 
			disconnected from the local function inside the <em>
			ScriptCleanupFunction</em> function.</li>
			<li style="box-sizing: border-box;">Execute (press the <kbd>F5</kbd> key) the QtScript code 
			again and notice that the script doen't automatically end this time. 
			The <strong>Execute</strong> command from the <em>Document</em> menu 
			(or the corresponding toolbar button) stays disabled. This button is 
			automatically enabled again by the internal script engine when the 
			script could successfully performed a Garbage Collection.</li>
			<li style="box-sizing: border-box;">Click on the <kbd>Restart Script 
			Engine</kbd> button to manually restart the whole script engine.</li>
		</ol>
   </div>
<!--doc-version-default-footer-begin-->
<!-- Please do not edit the below line(s) manually, see DocumentVersioning.qs (151018182358), version 1.0.0.1-->
	<script type="text/javascript">document.body.onload = function() {prettyPrint()};</script>
<!--doc-version-default-footer-end-->
 </body>
</html>
